<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>HeartmindSpaces — Invoice (Mobile)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Satisfy&family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js"></script>
<style>
  /* ─── RESET ──────────────────────────────── */
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --void: #000004;
    --holo: #00e5ff;
    --holo-dim: #007a8a;
    --holo-bright: #80f0ff;
    --border: rgba(0, 229, 255, 0.12);
    --border-bright: rgba(0, 229, 255, 0.35);
    --text: rgba(0, 229, 255, 0.85);
    --text-bright: #00e5ff;
    --text-dim: rgba(0, 180, 220, 0.45);
    --text-label: rgba(0, 180, 220, 0.55);
    --font-display: 'Satisfy', cursive;
    --font-body: 'Cormorant Garamond', serif;
  }

  html { scroll-behavior: smooth; -webkit-text-size-adjust: 100%; }

  body {
    background: var(--void);
    color: var(--text);
    font-family: var(--font-body);
    font-size: 14px;
    min-height: 100vh;
    overflow-x: hidden;
    overflow-y: auto;
    cursor: default;
    touch-action: manipulation;
    -webkit-tap-highlight-color: transparent;
  }

  /* ─── DEEP SPACE ─────────────────────────── */
  .space {
    position: fixed;
    inset: 0;
    z-index: 0;
    background: radial-gradient(ellipse 160% 100% at 50% 30%, #030818 0%, #000004 70%);
  }

  .space::before {
    content: '';
    position: absolute;
    inset: -80%;
    background-image:
      radial-gradient(1px 1px at 12% 20%, rgba(100,180,255,0.8), transparent),
      radial-gradient(1.2px 1.2px at 28% 65%, rgba(255,255,255,0.5), transparent),
      radial-gradient(0.8px 0.8px at 45% 12%, rgba(120,200,255,0.6), transparent),
      radial-gradient(1px 1px at 67% 78%, rgba(255,255,255,0.4), transparent),
      radial-gradient(1.5px 1.5px at 83% 35%, rgba(80,160,255,0.5), transparent),
      radial-gradient(0.6px 0.6px at 5% 88%, rgba(255,255,255,0.3), transparent),
      radial-gradient(1px 1px at 55% 45%, rgba(100,180,255,0.35), transparent),
      radial-gradient(0.8px 0.8px at 92% 58%, rgba(255,255,255,0.3), transparent),
      radial-gradient(1.3px 1.3px at 38% 82%, rgba(80,160,255,0.4), transparent),
      radial-gradient(0.7px 0.7px at 75% 15%, rgba(255,255,255,0.25), transparent);
    background-size: 500px 500px;
    animation: star-drift 300s linear infinite;
  }

  .space::after {
    content: '';
    position: absolute;
    inset: 0;
    background:
      radial-gradient(ellipse 400px 350px at 20% 25%, rgba(0,40,120,0.1), transparent),
      radial-gradient(ellipse 350px 500px at 80% 70%, rgba(0,20,80,0.07), transparent);
  }

  @keyframes star-drift { to { transform: translate(250px, 125px); } }

  /* ═══════════════════════════════════════════
     PROTON INTRO
     ═══════════════════════════════════════════ */
  .proton-intro {
    position: fixed;
    inset: 0;
    z-index: 200;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: opacity 0.8s ease;
  }

  .proton-intro.gone { opacity: 0; pointer-events: none; }

  .proton-assembly {
    position: relative;
    width: 200px;
    height: 200px;
    display: flex;
    align-items: center;
    justify-content: center;
    perspective: 800px;
    transform-style: preserve-3d;
  }

  /* ─── NUCLEUS ─────────────────────────────── */
  .proton-core {
    position: absolute;
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: radial-gradient(circle at 38% 36%,
      #ffffff 0%, #c8f8ff 12%, #00e5ff 35%,
      rgba(0,229,255,0.4) 60%, transparent 100%
    );
    box-shadow:
      0 0 20px rgba(0,229,255,0.9),
      0 0 45px rgba(0,229,255,0.55),
      0 0 80px rgba(0,229,255,0.3),
      inset 0 0 12px rgba(255,255,255,0.35);
    z-index: 10;
    animation: nucleus-breathe 3s ease-in-out infinite;
    transition: transform 0.3s ease, box-shadow 0.3s ease, background 0.2s ease, opacity 0.4s ease;
  }

  @keyframes nucleus-breathe {
    0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(0,229,255,0.9), 0 0 45px rgba(0,229,255,0.55), 0 0 80px rgba(0,229,255,0.3); }
    50% { transform: scale(1.08); box-shadow: 0 0 28px rgba(0,229,255,1), 0 0 55px rgba(0,229,255,0.65), 0 0 100px rgba(0,229,255,0.35); }
  }

  /* ─── QUARKS ──────────────────────────────── */
  .quark {
    position: absolute;
    width: 6px; height: 6px;
    border-radius: 50%;
    z-index: 11;
    top: 50%; left: 50%;
  }

  .quark-r {
    background: radial-gradient(circle, #ff6080 40%, transparent 100%);
    box-shadow: 0 0 5px #ff4060;
    animation: qp1 2.2s ease-in-out infinite;
  }

  .quark-g {
    background: radial-gradient(circle, #60ff90 40%, transparent 100%);
    box-shadow: 0 0 5px #40ff70;
    animation: qp2 2.8s ease-in-out infinite;
  }

  .quark-b {
    background: radial-gradient(circle, #6090ff 40%, transparent 100%);
    box-shadow: 0 0 5px #4070ff;
    animation: qp3 3.2s ease-in-out infinite;
  }

  @keyframes qp1 { 0%,100%{transform:translate(-8px,-3px)} 33%{transform:translate(5px,-7px)} 66%{transform:translate(3px,7px)} }
  @keyframes qp2 { 0%,100%{transform:translate(7px,-5px)} 33%{transform:translate(-4px,6px)} 66%{transform:translate(-7px,-2px)} }
  @keyframes qp3 { 0%,100%{transform:translate(0,8px)} 33%{transform:translate(7px,-2px)} 66%{transform:translate(-6px,-5px)} }

  /* ─── ORBITAL RINGS ───────────────────────── */
  .orbit-ring {
    position: absolute;
    width: 140px; height: 140px;
    border: 1px solid rgba(0,229,255,0.18);
    border-radius: 50%;
    top: 50%; left: 50%;
    margin-top: -70px; margin-left: -70px;
    transition: border-color 0.3s ease, opacity 0.3s ease;
  }

  .orbit-ring .electron {
    position: absolute;
    width: 4px; height: 4px;
    background: var(--holo-bright);
    border-radius: 50%;
    box-shadow: 0 0 6px var(--holo);
    top: -2px; left: 50%; margin-left: -2px;
  }

  .orbit-1 { animation: os1 7s linear infinite; }
  .orbit-2 {
    width: 130px; height: 130px;
    margin-top: -65px; margin-left: -65px;
    animation: os2 9s linear infinite;
  }

  @keyframes os1 { from{transform:rotateX(72deg) rotateZ(0)} to{transform:rotateX(72deg) rotateZ(360deg)} }
  @keyframes os2 { from{transform:rotateX(72deg) rotateY(60deg) rotateZ(0)} to{transform:rotateX(72deg) rotateY(60deg) rotateZ(360deg)} }

  /* ─── GLOW PINGS ──────────────────────────── */
  .glow-ping {
    position: absolute;
    width: 46px; height: 46px;
    border-radius: 50%;
    border: 1px solid rgba(0,229,255,0.2);
    top: 50%; left: 50%;
    margin-top: -23px; margin-left: -23px;
    animation: gp 4s ease-out infinite;
    pointer-events: none;
    z-index: 5;
  }

  .glow-ping:nth-child(2) { animation-delay: 1.33s; }
  .glow-ping:nth-child(3) { animation-delay: 2.66s; }

  @keyframes gp { 0%{transform:scale(1);opacity:0.4} 100%{transform:scale(4.5);opacity:0} }

  /* ─── PROTON LABEL ────────────────────────── */
  .proton-label {
    margin-top: 48px;
    font-family: var(--font-display);
    font-size: 20px;
    color: rgba(0,229,255,0.4);
    letter-spacing: 2px;
    text-shadow: 0 0 14px rgba(0,229,255,0.15);
    opacity: 0;
    animation: lm 1.2s ease-out 0.8s forwards, lb 5s ease-in-out 2s infinite;
    user-select: none;
  }

  @keyframes lm { from{opacity:0;transform:translateY(10px);letter-spacing:6px} to{opacity:1;transform:translateY(0);letter-spacing:2px} }
  @keyframes lb { 0%,100%{opacity:0.6} 50%{opacity:1;text-shadow:0 0 22px rgba(0,229,255,0.3)} }

  /* ─── BURST EFFECTS ───────────────────────── */
  .shockwave {
    position: absolute;
    top: 50%; left: 50%;
    width: 0; height: 0;
    border-radius: 50%;
    border: 2px solid rgba(0,229,255,0.7);
    transform: translate(-50%,-50%);
    pointer-events: none;
    opacity: 0;
  }

  .shockwave.active { animation: swe 1s ease-out forwards; }

  @keyframes swe {
    0% { width:0;height:0;opacity:1;border-width:3px }
    60% { opacity:0.5 }
    100% { width:200vmax;height:200vmax;opacity:0;border-width:0.5px }
  }

  .screen-flash {
    position: fixed; inset: 0;
    background: radial-gradient(circle at 50% 50%, rgba(200,248,255,0.5), rgba(0,229,255,0.15), transparent 70%);
    pointer-events: none; opacity: 0; z-index: 250;
  }

  .screen-flash.active { animation: sf 0.6s ease-out forwards; }
  @keyframes sf { 0%{opacity:1} 100%{opacity:0} }

  #burstCanvas { position: fixed; inset: 0; z-index: 210; pointer-events: none; display: none; }

  /* ═══════════════════════════════════════════
     INVOICE CONTAINER
     ═══════════════════════════════════════════ */
  .invoice-container {
    opacity: 0;
    transform: scale(0.88);
    transition: opacity 1s ease-out, transform 1s cubic-bezier(0.22,1,0.36,1);
    pointer-events: none;
  }

  .invoice-container.revealed {
    opacity: 1; transform: scale(1); pointer-events: auto;
  }

  .holo-scene {
    position: relative;
    z-index: 1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    perspective: 1200px;
    perspective-origin: 50% 60%;
    padding: 60px 12px 140px;
  }

  /* ─── EMITTER ──────────────────────────────── */
  .emitter {
    position: relative;
    width: 100%;
    max-width: 400px;
    height: 14px;
    margin-top: 20px;
    z-index: 5;
  }

  .emitter-body {
    position: absolute;
    bottom: 0; left: 50%;
    transform: translateX(-50%);
    width: 200px; height: 10px;
    background: linear-gradient(180deg, #0a2030, #051018);
    border: 1px solid rgba(0,229,255,0.15);
    border-radius: 5px;
    box-shadow: 0 0 16px rgba(0,229,255,0.08);
  }

  .emitter-core {
    position: absolute;
    bottom: 2px; left: 50%;
    transform: translateX(-50%);
    width: 60px; height: 3px;
    background: var(--holo);
    border-radius: 2px;
    box-shadow: 0 0 8px var(--holo), 0 0 20px rgba(0,229,255,0.4);
    animation: ep 2s ease-in-out infinite;
  }

  .emitter-ring {
    position: absolute;
    bottom: -3px; left: 50%;
    transform: translateX(-50%);
    width: 100px; height: 6px;
    border: 1px solid rgba(0,229,255,0.06);
    border-radius: 50%;
    animation: re 3s ease-out infinite;
  }

  .emitter-ring:nth-child(3) { animation-delay: 1s; }
  .emitter-ring:nth-child(4) { animation-delay: 2s; }

  @keyframes ep { 0%,100%{opacity:0.8} 50%{opacity:1;box-shadow:0 0 12px var(--holo),0 0 28px rgba(0,229,255,0.5)} }
  @keyframes re { 0%{width:60px;opacity:0.3} 100%{width:300px;opacity:0} }

  /* ─── BEAM ─────────────────────────────────── */
  .beam {
    position: absolute;
    bottom: 100%; left: 50%;
    transform: translateX(-50%);
    width: 0; height: 0;
    border-left: 300px solid transparent;
    border-right: 300px solid transparent;
    border-bottom: 700px solid rgba(0,229,255,0.01);
    pointer-events: none;
    filter: blur(1px);
  }

  /* ─── HOLOGRAM CARD ────────────────────────── */
  .holo-wrap {
    transform-style: preserve-3d;
    width: 100%;
    max-width: 860px;
    animation: hf 10s ease-in-out infinite;
    will-change: transform;
    position: relative;
  }

  @keyframes hf {
    0%,100% { transform: translateY(0) rotateX(1.5deg); }
    50% { transform: translateY(-6px) rotateX(2deg); }
  }

  .hologram {
    position: relative;
    background: rgba(0,20,40,0.45);
    border: 1px solid var(--border-bright);
    padding: 32px 20px;
    overflow: hidden;
    backdrop-filter: blur(2px);
    box-shadow:
      0 0 24px rgba(0,229,255,0.08),
      0 0 50px rgba(0,229,255,0.03),
      inset 0 0 50px rgba(0,229,255,0.02);
    animation: hfl 0.15s steps(2) infinite;
  }

  .hologram::before {
    content: '';
    position: absolute; inset: 0;
    background: repeating-linear-gradient(180deg, transparent 0px, transparent 2px, rgba(0,229,255,0.012) 2px, rgba(0,229,255,0.012) 4px);
    pointer-events: none; z-index: 60;
    animation: ss 8s linear infinite;
  }

  @keyframes ss { to { transform: translateY(4px); } }

  .hologram::after {
    content: '';
    position: absolute; inset: 0;
    background:
      repeating-linear-gradient(90deg, rgba(0,229,255,0.015) 0px, transparent 1px, transparent 50px),
      repeating-linear-gradient(0deg, rgba(0,229,255,0.015) 0px, transparent 1px, transparent 50px);
    pointer-events: none; z-index: 59;
  }

  @keyframes hfl { 0%{opacity:1} 50%{opacity:0.985} 51%{opacity:1} 100%{opacity:0.99} }

  .scan-bar {
    position: absolute; left: 0; right: 0; height: 50px;
    background: linear-gradient(180deg, transparent, rgba(0,229,255,0.05) 40%, rgba(0,229,255,0.05) 60%, transparent);
    pointer-events: none; z-index: 61;
    animation: ssw 6s ease-in-out infinite;
  }

  @keyframes ssw { 0%,100%{top:-50px} 50%{top:100%} }

  .chroma-edge {
    position: absolute; inset: -2px; pointer-events: none; z-index: 62;
    box-shadow: inset 2px 0 0 rgba(255,0,80,0.05), inset -2px 0 0 rgba(0,100,255,0.05);
  }

  .glitch-layer {
    position: absolute; inset: 0; pointer-events: none; z-index: 63;
    opacity: 0; animation: gt 10s ease-in-out infinite;
  }

  @keyframes gt {
    0%,94%,100% { opacity:0;transform:none }
    95% { opacity:0.8;transform:translateX(2px) skewX(-0.5deg);clip-path:inset(25% 0 55% 0) }
    96% { opacity:0;transform:none }
  }

  .glitch-layer::before { content:''; position:absolute; inset:0; background:rgba(0,229,255,0.06); mix-blend-mode:overlay; }

  .corner { position: absolute; width: 16px; height: 16px; z-index: 64; }
  .corner-tl { top:-1px;left:-1px;border-top:2px solid var(--holo);border-left:2px solid var(--holo); }
  .corner-tr { top:-1px;right:-1px;border-top:2px solid var(--holo);border-right:2px solid var(--holo); }
  .corner-bl { bottom:-1px;left:-1px;border-bottom:2px solid var(--holo);border-left:2px solid var(--holo); }
  .corner-br { bottom:-1px;right:-1px;border-bottom:2px solid var(--holo);border-right:2px solid var(--holo); }

  .corner::after {
    content:''; position:absolute; width:3px; height:3px;
    background:var(--holo); box-shadow:0 0 5px var(--holo);
  }

  .corner-tl::after{top:-1px;left:-1px} .corner-tr::after{top:-1px;right:-1px}
  .corner-bl::after{bottom:-1px;left:-1px} .corner-br::after{bottom:-1px;right:-1px}

  /* ─── HEADER ─────────────────────────────── */
  .header {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 28px;
    padding-bottom: 20px;
    border-bottom: 1px solid var(--border);
    position: relative; z-index: 10;
  }

  .brand { display: flex; flex-direction: column; gap: 4px; }

  .brand-icon {
    width: 30px; height: 30px;
    border: 1.5px solid var(--holo);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    margin-bottom: 6px;
    box-shadow: 0 0 10px rgba(0,229,255,0.2);
  }

  .brand-icon::after { content:''; width:5px; height:5px; background:var(--holo); border-radius:50%; box-shadow:0 0 6px var(--holo); }

  .brand-name {
    font-family: var(--font-display);
    font-size: 28px; color: var(--holo);
    line-height: 1.1; letter-spacing: 0.5px;
    text-shadow: 0 0 10px rgba(0,229,255,0.4);
  }

  .invoice-title { text-align: left; }

  .invoice-title h1 {
    font-family: var(--font-display);
    font-size: 38px; color: var(--holo-bright);
    line-height: 1; margin-bottom: 8px; letter-spacing: 1px;
    text-shadow: 0 0 14px rgba(0,229,255,0.45);
  }

  /* ─── EDITABLE FIELDS ────────────────────── */
  [contenteditable] {
    outline: none;
    border-bottom: 1px dashed rgba(0,229,255,0.2);
    padding: 4px 6px; margin: -4px -6px;
    transition: all 0.2s ease;
    min-width: 40px; display: inline-block;
    color: var(--text);
    min-height: 28px;
  }

  [contenteditable]:focus {
    border-bottom-color: var(--holo);
    background: rgba(0,229,255,0.08);
    box-shadow: 0 2px 10px rgba(0,229,255,0.1);
  }

  [contenteditable]:empty::before {
    content: attr(data-placeholder);
    color: var(--text-dim); font-style: italic;
  }

  /* ─── META ROW ───────────────────────────── */
  .meta-row {
    display: flex; flex-wrap: wrap;
    gap: 16px; margin-bottom: 28px;
    position: relative; z-index: 10;
  }

  .meta-item { text-align: left; flex: 1; min-width: 100px; }

  .meta-label {
    font-family: var(--font-body);
    font-size: 9px; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-label);
    margin-bottom: 3px; font-weight: 600;
  }

  .meta-value { font-size: 14px; color: var(--text-bright); font-weight: 600; }

  /* ─── PARTIES ──────────────────────────────── */
  .parties {
    display: grid; grid-template-columns: 1fr;
    gap: 24px; margin-bottom: 28px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border);
    position: relative; z-index: 10;
  }

  .party-label {
    font-family: var(--font-body);
    font-size: 9px; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-label);
    margin-bottom: 8px; font-weight: 600;
    display: flex; align-items: center; gap: 6px;
  }

  .party-label::before {
    content:''; width:12px; height:1px;
    background:var(--holo-dim); box-shadow:0 0 3px var(--holo-dim);
  }

  .party-name {
    font-family: var(--font-display);
    font-size: 22px; color: var(--holo);
    margin-bottom: 4px; letter-spacing: 0.5px;
    text-shadow: 0 0 8px rgba(0,229,255,0.2);
  }

  .party-details { line-height: 1.8; color: var(--text); font-size: 12px; }
  .party-details [contenteditable] { display: block; width: 100%; }

  /* ─── LINE ITEMS TABLE ───────────────────── */
  .line-items { margin-bottom: 24px; position: relative; z-index: 10; overflow-x: auto; }
  .items-table { width: 100%; border-collapse: collapse; min-width: 380px; }

  .items-table thead th {
    font-family: var(--font-body);
    font-size: 9px; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-label);
    font-weight: 600; text-align: left;
    padding: 0 8px 10px; white-space: nowrap;
    border-bottom: 1px solid var(--border-bright);
  }

  .items-table thead th:nth-child(2),
  .items-table thead th:nth-child(3),
  .items-table thead th:nth-child(4) { text-align: right; }

  .items-table tbody td {
    padding: 12px 8px;
    border-bottom: 1px solid var(--border);
    vertical-align: top;
  }

  .items-table tbody td:nth-child(2),
  .items-table tbody td:nth-child(3),
  .items-table tbody td:nth-child(4) {
    text-align: right; font-variant-numeric: tabular-nums;
  }

  .item-desc { color: var(--text-bright); font-size: 13px; }
  .item-subdesc { color: var(--text-dim); font-size: 11px; margin-top: 2px; }

  .add-row {
    display: flex; align-items: center; gap: 6px;
    padding: 12px 10px; color: var(--text-dim);
    font-family: var(--font-body);
    font-size: 11px; letter-spacing: 1.5px;
    text-transform: uppercase; cursor: pointer;
    border: 1px dashed rgba(0,229,255,0.1);
    background: transparent; width: 100%;
    transition: all 0.2s ease;
    margin-top: 4px; font-weight: 600;
    min-height: 44px;
  }

  .add-row span { font-size: 16px; line-height: 1; }

  /* ─── TOTALS ─────────────────────────────── */
  .totals-section {
    display: flex; justify-content: flex-end;
    margin-bottom: 28px; position: relative; z-index: 10;
  }

  .totals { width: 100%; max-width: 300px; }

  .total-row {
    display: flex; justify-content: space-between;
    padding: 8px 0; border-bottom: 1px solid var(--border);
    align-items: center;
  }

  .total-row:last-child {
    border-bottom: none; padding-top: 12px; margin-top: 4px;
    border-top: 1px solid var(--border-bright);
  }

  .total-label {
    font-family: var(--font-body);
    font-size: 10px; letter-spacing: 1.5px;
    text-transform: uppercase; color: var(--text-dim); font-weight: 600;
  }

  .total-row:last-child .total-label { color: var(--text-label); font-size: 11px; }

  .total-value { font-weight: 700; color: var(--text-bright); font-variant-numeric: tabular-nums; }

  .total-row:last-child .total-value {
    font-family: var(--font-display);
    font-size: 24px; color: var(--holo-bright);
    text-shadow: 0 0 12px rgba(0,229,255,0.4);
  }

  /* ─── FOOTER ─────────────────────────────── */
  .footer {
    display: grid; grid-template-columns: 1fr;
    gap: 20px; padding-top: 20px;
    border-top: 1px solid var(--border);
    position: relative; z-index: 10;
  }

  .footer-section-label {
    font-family: var(--font-body);
    font-size: 9px; letter-spacing: 2px;
    text-transform: uppercase; color: var(--text-label);
    margin-bottom: 6px; font-weight: 600;
  }

  .footer-content { font-size: 12px; line-height: 1.7; color: var(--text); }

  /* ─── STATUS BADGE ─────────────────────────── */
  .status-badge {
    display: inline-flex; align-items: center; gap: 6px;
    padding: 6px 16px;
    border: 1px solid var(--holo-dim);
    font-family: var(--font-body);
    font-size: 10px; letter-spacing: 2px;
    text-transform: uppercase; color: var(--holo-dim);
    font-weight: 600; cursor: pointer;
    margin-top: 4px; transition: all 0.2s ease;
    min-height: 36px;
  }

  .status-dot {
    width: 5px; height: 5px; border-radius: 50%;
    background: var(--holo-dim);
    box-shadow: 0 0 5px rgba(0,229,255,0.4);
    animation: pd 2s ease-in-out infinite;
  }

  .status-badge.paid { border-color: #00cc66; color: #00cc66; }
  .status-badge.paid .status-dot { background: #00cc66; box-shadow: 0 0 5px rgba(0,204,102,0.4); }

  @keyframes pd { 0%,100%{opacity:1} 50%{opacity:0.3} }

  /* ─── HUD (simplified for mobile) ──────── */
  .hud-label {
    position: absolute;
    font-family: var(--font-body);
    font-size: 8px; letter-spacing: 1.5px;
    color: var(--text-dim);
    text-transform: uppercase;
    z-index: 65; pointer-events: none; font-weight: 600;
  }

  .hud-tl { top: 10px; left: 12px; }
  .hud-tr { top: 10px; right: 12px; text-align: right; }
  .hud-bl { bottom: 10px; left: 12px; }
  .hud-br { bottom: 10px; right: 12px; text-align: right; }

  .hud-label .val { color: var(--holo-dim); font-size: 10px; letter-spacing: 0.5px; font-style: italic; }

  /* ─── PARTICLES (canvas) ─────────────────── */
  #particleCanvas { position: fixed; inset: 0; z-index: 1; pointer-events: none; }

  /* ─── TOOLBAR ────────────────────────────── */
  .toolbar {
    position: fixed; bottom: 0; left: 0; right: 0;
    display: flex; flex-wrap: wrap;
    justify-content: center;
    gap: 1px;
    background: rgba(0,8,20,0.95);
    border-top: 1px solid rgba(0,229,255,0.1);
    padding: 6px 4px;
    padding-bottom: calc(6px + env(safe-area-inset-bottom));
    z-index: 100;
    backdrop-filter: blur(12px);
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease, transform 0.6s ease;
    pointer-events: none;
  }

  .toolbar.visible {
    opacity: 1; transform: translateY(0); pointer-events: auto;
  }

  .toolbar button {
    font-family: var(--font-body);
    font-size: 11px; letter-spacing: 1px;
    text-transform: uppercase;
    padding: 10px 14px;
    background: transparent; border: none;
    color: rgba(0,229,255,0.35);
    cursor: pointer; transition: all 0.15s ease;
    font-weight: 600;
    min-height: 44px;
  }

  .toolbar button:active {
    color: var(--holo);
    background: rgba(0,229,255,0.08);
  }

  .toolbar button.primary-action {
    color: var(--holo);
    border: 1px solid rgba(0,229,255,0.2);
  }

  .toolbar .sep { width: 1px; background: rgba(0,229,255,0.06); margin: 6px 1px; }

  /* ─── RESPONSIVE: LARGER MOBILE / SMALL TABLET ── */
  @media (min-width: 600px) {
    .hologram { padding: 40px 36px; }
    .header { flex-direction: row; justify-content: space-between; align-items: flex-start; }
    .invoice-title { text-align: right; }
    .parties { grid-template-columns: 1fr 1fr; gap: 36px; }
    .footer { grid-template-columns: 1fr 1fr; gap: 36px; }
    .brand-name { font-size: 32px; }
    .invoice-title h1 { font-size: 46px; }
    .meta-row { justify-content: flex-end; }
    .meta-item { text-align: right; flex: none; }
  }

  /* ─── RESPONSIVE: TABLET / SMALL DESKTOP ─────── */
  @media (min-width: 860px) {
    .hologram { padding: 52px 58px; }
    .holo-scene { padding: 80px 20px 180px; }
    .brand-name { font-size: 34px; }
    .invoice-title h1 { font-size: 52px; }
    .party-name { font-size: 26px; }
    .proton-assembly { width: 240px; height: 240px; }
    .proton-core { width: 52px; height: 52px; }
    .orbit-ring { width: 170px; height: 170px; margin-top: -85px; margin-left: -85px; }
    .orbit-2 { width: 160px; height: 160px; margin-top: -80px; margin-left: -80px; }
    .proton-label { font-size: 24px; margin-top: 60px; }
    .toolbar {
      bottom: 24px; left: 50%; right: auto;
      transform: translateX(-50%) translateY(20px);
      border-top: none; border: 1px solid rgba(0,229,255,0.1);
      flex-wrap: nowrap;
      padding-bottom: 4px;
    }
    .toolbar.visible { transform: translateX(-50%) translateY(0); }
  }

  /* ─── PRINT ──────────────────────────────── */
  @media print {
    body { background: #fff; color: #111; }
    .space, .toolbar, .add-row, #particleCanvas, #burstCanvas,
    .scan-bar, .chroma-edge, .glitch-layer, .emitter,
    .beam, .hud-label, .proton-intro { display: none !important; }
    .invoice-container { opacity:1!important; transform:none!important; pointer-events:auto!important; }
    .holo-scene { perspective:none; padding:0; min-height:auto; }
    .holo-wrap { animation:none!important; transform:none!important; }
    .hologram { background:#fff; border:1px solid #ddd; box-shadow:none; padding:24px; animation:none!important; }
    .hologram::before, .hologram::after { display:none; }
    .corner { display:none; }
    .brand-name, .party-name, .invoice-title h1 { color:#111!important; text-shadow:none!important; }
    [contenteditable] { color:#222!important; border-bottom-color:transparent; }
    .meta-label, .party-label, .total-label, .footer-section-label, .items-table thead th { color:#666!important; }
    .total-row:last-child .total-value { color:#111!important; text-shadow:none!important; }
    .status-badge { border-color:#666; color:#666; }
  }
</style>
</head>
<body>

<div class="space"></div>
<canvas id="burstCanvas"></canvas>
<canvas id="particleCanvas"></canvas>

<!-- ═══ PROTON INTRO ════════════════════════════ -->
<div class="proton-intro" id="protonIntro">
  <div class="proton-assembly">
    <div class="glow-ping"></div>
    <div class="glow-ping"></div>
    <div class="glow-ping"></div>
    <div class="orbit-ring orbit-1"><div class="electron"></div></div>
    <div class="orbit-ring orbit-2"><div class="electron"></div></div>
    <div class="proton-core"></div>
    <div class="quark quark-r"></div>
    <div class="quark quark-g"></div>
    <div class="quark quark-b"></div>
  </div>
  <div class="proton-label">open your invoice</div>
  <div class="shockwave" id="shockwave"></div>
  <div class="screen-flash" id="screenFlash"></div>
</div>

<!-- ═══ INVOICE ═════════════════════════════════ -->
<div class="invoice-container" id="invoiceContainer">
  <div class="holo-scene">
    <div class="holo-wrap" id="holoWrap">
      <div class="hologram" id="holoCard">
        <div class="scan-bar"></div>
        <div class="chroma-edge"></div>
        <div class="glitch-layer"></div>
        <div class="corner corner-tl"></div>
        <div class="corner corner-tr"></div>
        <div class="corner corner-bl"></div>
        <div class="corner corner-br"></div>

        <div class="hud-label hud-tl">Invoice<br><span class="val" id="hudTime">00:00:00</span></div>
        <div class="hud-label hud-tr">HeartmindSpaces<br><span class="val">v3.2.1</span></div>
        <div class="hud-label hud-bl">Projection<br><span class="val">Active</span></div>
        <div class="hud-label hud-br">Signal<br><span class="val" id="hudSignal">98.7%</span></div>

        <div class="header">
          <div class="brand">
            <div class="brand-icon"></div>
            <div class="brand-name">HeartmindSpaces</div>
          </div>
          <div class="invoice-title">
            <h1>Invoice</h1>
            <div class="status-badge" id="statusBadge">
              <span class="status-dot"></span>
              <span class="status-text">Pending</span>
            </div>
          </div>
        </div>

        <div class="meta-row">
          <div class="meta-item">
            <div class="meta-label">Invoice No.</div>
            <div class="meta-value"><span contenteditable="true" data-placeholder="HMS-0001">HMS-0001</span></div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Issue Date</div>
            <div class="meta-value"><span contenteditable="true" data-placeholder="2026-02-23">2026-02-23</span></div>
          </div>
          <div class="meta-item">
            <div class="meta-label">Due Date</div>
            <div class="meta-value"><span contenteditable="true" data-placeholder="2026-03-23">2026-03-23</span></div>
          </div>
        </div>

        <div class="parties">
          <div class="party-from">
            <div class="party-label">From</div>
            <div class="party-name"><span contenteditable="true" data-placeholder="Your Business Name">HeartmindSpaces LLC</span></div>
            <div class="party-details">
              <span contenteditable="true" data-placeholder="Street Address">123 Constellation Ave</span>
              <span contenteditable="true" data-placeholder="City, Province Postal Code">Ontario, CA</span>
              <span contenteditable="true" data-placeholder="Email">hello@heartmindspaces.com</span>
              <span contenteditable="true" data-placeholder="Phone">+1 (512) 000-0000</span>
              <span contenteditable="true" data-placeholder="Business Number"></span>
            </div>
          </div>
          <div class="party-to">
            <div class="party-label">Bill To</div>
            <div class="party-name"><span contenteditable="true" data-placeholder="Client Name"></span></div>
            <div class="party-details">
              <span contenteditable="true" data-placeholder="Street Address"></span>
              <span contenteditable="true" data-placeholder="City, Province Postal Code"></span>
              <span contenteditable="true" data-placeholder="Email"></span>
              <span contenteditable="true" data-placeholder="Phone"></span>
              <span contenteditable="true" data-placeholder="Business Number"></span>
            </div>
          </div>
        </div>

        <div class="line-items">
          <table class="items-table">
            <thead>
              <tr>
                <th style="width:46%">Description</th>
                <th style="width:12%">Qty</th>
                <th style="width:20%">Rate</th>
                <th style="width:22%">Amount</th>
              </tr>
            </thead>
            <tbody id="itemsBody">
              <tr>
                <td>
                  <div class="item-desc"><span contenteditable="true" data-placeholder="Service or product name"></span></div>
                  <div class="item-subdesc"><span contenteditable="true" data-placeholder="Additional details..."></span></div>
                </td>
                <td><span contenteditable="true" class="qty" data-placeholder="0">1</span></td>
                <td><span contenteditable="true" class="rate" data-placeholder="0.00">0.00</span></td>
                <td class="line-total">$0.00</td>
              </tr>
              <tr>
                <td>
                  <div class="item-desc"><span contenteditable="true" data-placeholder="Service or product name"></span></div>
                  <div class="item-subdesc"><span contenteditable="true" data-placeholder="Additional details..."></span></div>
                </td>
                <td><span contenteditable="true" class="qty" data-placeholder="0">1</span></td>
                <td><span contenteditable="true" class="rate" data-placeholder="0.00">0.00</span></td>
                <td class="line-total">$0.00</td>
              </tr>
              <tr>
                <td>
                  <div class="item-desc"><span contenteditable="true" data-placeholder="Service or product name"></span></div>
                  <div class="item-subdesc"><span contenteditable="true" data-placeholder="Additional details..."></span></div>
                </td>
                <td><span contenteditable="true" class="qty" data-placeholder="0">1</span></td>
                <td><span contenteditable="true" class="rate" data-placeholder="0.00">0.00</span></td>
                <td class="line-total">$0.00</td>
              </tr>
            </tbody>
          </table>
          <button class="add-row" id="addRowBtn"><span>+</span> Add Line Item</button>
        </div>

        <div class="totals-section">
          <div class="totals">
            <div class="total-row">
              <span class="total-label">Subtotal</span>
              <span class="total-value" id="subtotal">$0.00</span>
            </div>
            <div class="total-row">
              <span class="total-label">Tax (<span contenteditable="true" id="taxRate">0</span>%)</span>
              <span class="total-value" id="taxAmount">$0.00</span>
            </div>
            <div class="total-row">
              <span class="total-label">Discount</span>
              <span class="total-value">-$<span contenteditable="true" id="discount">0.00</span></span>
            </div>
            <div class="total-row">
              <span class="total-label">Total Due</span>
              <span class="total-value" id="totalDue">$0.00</span>
            </div>
          </div>
        </div>

        <div class="footer">
          <div>
            <div class="footer-section-label">Payment Details</div>
            <div class="footer-content">
              <span contenteditable="true" data-placeholder="Bank / Payment method details...">Bank: First National | Routing: 000000000 | Account: 000000000</span>
            </div>
          </div>
          <div>
            <div class="footer-section-label">Notes &amp; Terms</div>
            <div class="footer-content">
              <span contenteditable="true" data-placeholder="Payment terms, thank you note...">Payment due within 30 days of issue date. Late payments may incur a 1.5% monthly fee. Thank you for your trust in HeartmindSpaces.</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="emitter">
      <div class="beam"></div>
      <div class="emitter-body"></div>
      <div class="emitter-core"></div>
      <div class="emitter-ring"></div>
      <div class="emitter-ring"></div>
      <div class="emitter-ring"></div>
    </div>
  </div>
</div>

<div class="toolbar" id="toolbar">
  <button id="downloadPdfBtn" class="primary-action">PDF</button>
  <div class="sep"></div>
  <button id="saveHtmlBtn">HTML</button>
  <div class="sep"></div>
  <button id="printBtn">Print</button>
  <div class="sep"></div>
  <button id="addRowBtn2">+ Row</button>
  <div class="sep"></div>
  <button id="recalcBtn">Calc</button>
  <div class="sep"></div>
  <button id="resetBtn">Reset</button>
</div>

<script>
  // ═══ DEVICE DETECTION ═══
  var isMobile = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0);

  // ═══ AMBIENT PARTICLES (reduced for mobile) ═══
  (function() {
    var canvas = document.getElementById('particleCanvas');
    var ctx = canvas.getContext('2d');
    var particles = [];
    var count = isMobile ? 30 : 60;

    function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    resize();
    window.addEventListener('resize', resize);

    function P() { this.reset(); }
    P.prototype.reset = function() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 1.2 + 0.3;
      this.speedX = (Math.random() - 0.5) * 0.25;
      this.speedY = (Math.random() - 0.5) * 0.15 - 0.08;
      this.opacity = Math.random() * 0.35 + 0.1;
      this.pulse = Math.random() * Math.PI * 2;
      this.pulseSpeed = Math.random() * 0.015 + 0.005;
    };
    P.prototype.update = function() {
      this.x += this.speedX; this.y += this.speedY; this.pulse += this.pulseSpeed;
      if (this.x < -10 || this.x > canvas.width + 10 || this.y < -10 || this.y > canvas.height + 10) this.reset();
    };
    P.prototype.draw = function() {
      var o = this.opacity * (0.5 + 0.5 * Math.sin(this.pulse));
      ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = 'rgba(0,229,255,' + o + ')'; ctx.fill();
    };

    for (var i = 0; i < count; i++) particles.push(new P());

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (var i = 0; i < particles.length; i++) { particles[i].update(); particles[i].draw(); }
      requestAnimationFrame(animate);
    }
    animate();
  })();

  // ═══ BURST PARTICLES (tuned for mobile) ═══
  function triggerBurst(cx, cy) {
    var canvas = document.getElementById('burstCanvas');
    var ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    canvas.style.display = 'block';

    var particles = [];
    var count = isMobile ? 100 : 200;

    for (var i = 0; i < count; i++) {
      var angle = Math.random() * Math.PI * 2;
      var speed = Math.random() * 22 + 8;
      var size = Math.random() * 3 + 0.5;
      var isEmber = Math.random() > 0.85;
      particles.push({
        x: cx, y: cy,
        vx: Math.cos(angle) * speed * (isEmber ? 0.6 : 1),
        vy: Math.sin(angle) * speed * (isEmber ? 0.6 : 1),
        size: isEmber ? size * 2.5 : size,
        life: 1,
        decay: isEmber ? 0.003 : (Math.random() * 0.007 + 0.004),
        hue: isEmber ? 170 + Math.random() * 30 : 180 + Math.random() * 20
      });
    }

    var streakCount = isMobile ? 20 : 36;
    for (var j = 0; j < streakCount; j++) {
      var a = (j / streakCount) * Math.PI * 2;
      particles.push({
        x: cx, y: cy,
        vx: Math.cos(a) * 34,
        vy: Math.sin(a) * 34,
        size: 1.8, life: 1, decay: 0.01,
        hue: 185, isStreak: true, trail: []
      });
    }

    function animate() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      var alive = false;

      for (var i = 0; i < particles.length; i++) {
        var p = particles[i];
        if (p.life <= 0) continue;
        alive = true;
        p.x += p.vx; p.y += p.vy;
        p.vx *= 0.993; p.vy *= 0.993;
        p.life -= p.decay;

        if (p.isStreak) {
          p.trail.push({ x: p.x, y: p.y, life: p.life });
          if (p.trail.length > 14) p.trail.shift();
          for (var t = 0; t < p.trail.length; t++) {
            var tp = p.trail[t];
            var to = tp.life * (t / p.trail.length) * 0.6;
            ctx.beginPath(); ctx.arc(tp.x, tp.y, 1, 0, Math.PI * 2);
            ctx.fillStyle = 'hsla(' + p.hue + ',100%,75%,' + to + ')'; ctx.fill();
          }
        }

        ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
        ctx.fillStyle = 'hsla(' + p.hue + ',100%,72%,' + p.life + ')'; ctx.fill();
        ctx.beginPath(); ctx.arc(p.x, p.y, p.size * p.life * 3, 0, Math.PI * 2);
        ctx.fillStyle = 'hsla(' + p.hue + ',100%,72%,' + (p.life * 0.1) + ')'; ctx.fill();
      }

      if (alive) requestAnimationFrame(animate);
      else canvas.style.display = 'none';
    }
    animate();
  }

  // ═══ PROTON CLICK → TRANSITION ═══
  (function() {
    var intro = document.getElementById('protonIntro');
    var core = document.querySelector('.proton-core');
    var orbits = document.querySelectorAll('.orbit-ring');
    var quarks = document.querySelectorAll('.quark');
    var label = document.querySelector('.proton-label');
    var pings = document.querySelectorAll('.glow-ping');
    var invoice = document.getElementById('invoiceContainer');
    var toolbar = document.getElementById('toolbar');
    var shockwave = document.getElementById('shockwave');
    var flash = document.getElementById('screenFlash');
    var triggered = false;

    intro.addEventListener('click', function() {
      if (triggered) return;
      triggered = true;
      intro.style.cursor = 'default';

      core.style.animation = 'none';
      core.style.transform = 'scale(1.5)';
      core.style.boxShadow = '0 0 50px rgba(0,229,255,1),0 0 100px rgba(0,229,255,0.7),0 0 180px rgba(0,229,255,0.4)';
      orbits.forEach(function(o) { o.style.animationDuration = '0.4s'; });
      pings.forEach(function(p) { p.style.animationDuration = '0.5s'; });

      setTimeout(function() {
        core.style.transition = 'transform 0.2s ease-in,background 0.15s ease,box-shadow 0.2s ease';
        core.style.transform = 'scale(4)';
        core.style.background = 'radial-gradient(circle,#fff 0%,#d0f8ff 30%,#00e5ff 60%,transparent 100%)';
        core.style.boxShadow = '0 0 80px #fff,0 0 160px rgba(0,229,255,1),0 0 280px rgba(0,229,255,0.5)';
        quarks.forEach(function(q) { q.style.transition = 'opacity 0.15s'; q.style.opacity = '0'; });
      }, 300);

      setTimeout(function() {
        var rect = core.getBoundingClientRect();
        triggerBurst(rect.left + rect.width / 2, rect.top + rect.height / 2);
        shockwave.classList.add('active');
        flash.classList.add('active');
        core.style.transition = 'transform 0.5s ease-out,opacity 0.4s ease-out';
        core.style.transform = 'scale(0)'; core.style.opacity = '0';
        orbits.forEach(function(o) { o.style.transition = 'opacity 0.35s'; o.style.opacity = '0'; });
        pings.forEach(function(p) { p.style.transition = 'opacity 0.25s'; p.style.opacity = '0'; });
        label.style.transition = 'opacity 0.4s,transform 0.4s';
        label.style.opacity = '0'; label.style.transform = 'translateY(-15px)';
      }, 500);

      setTimeout(function() {
        invoice.classList.add('revealed');
        intro.classList.add('gone');
        document.body.style.cursor = 'crosshair';
      }, 1000);

      setTimeout(function() {
        toolbar.classList.add('visible');
        intro.style.display = 'none';
      }, 2000);
    });
  })();

  // ═══ HUD CLOCK ═══
  (function() {
    var hudTime = document.getElementById('hudTime');
    var hudSignal = document.getElementById('hudSignal');
    function tick() {
      var d = new Date();
      hudTime.textContent = String(d.getHours()).padStart(2,'0') + ':' + String(d.getMinutes()).padStart(2,'0') + ':' + String(d.getSeconds()).padStart(2,'0');
      hudSignal.textContent = (97 + Math.random() * 2.8).toFixed(1) + '%';
    }
    tick(); setInterval(tick, 1000);
  })();

  // ═══ 3D MOUSE TRACKING (desktop only) ═══
  var wrap = document.getElementById('holoWrap');
  var isEditing = false;

  if (!isMobile) {
    document.addEventListener('focusin', function(e) {
      if (e.target.getAttribute('contenteditable')) { isEditing = true; wrap.style.animation = 'none'; wrap.style.transform = 'rotateX(0) rotateY(0)'; }
    });
    document.addEventListener('focusout', function(e) {
      if (e.target.getAttribute('contenteditable')) { isEditing = false; wrap.style.animation = ''; }
    });
    document.addEventListener('mousemove', function(e) {
      if (isEditing) return;
      var mx = (e.clientX / window.innerWidth - 0.5) * 2;
      var my = (e.clientY / window.innerHeight - 0.5) * 2;
      wrap.style.animation = 'none';
      wrap.style.transform = 'translateY(-6px) rotateX(' + (2 - my * 2.5) + 'deg) rotateY(' + (mx * 5) + 'deg)';
    });
    document.addEventListener('mouseleave', function() {
      if (!isEditing) { wrap.style.animation = ''; wrap.style.transform = ''; }
    });
  }

  // ═══ SAFE DOM ROW BUILDER ═══
  function createEditableSpan(cls, ph, txt) {
    var s = document.createElement('span');
    s.setAttribute('contenteditable', 'true');
    s.setAttribute('data-placeholder', ph);
    if (cls) s.className = cls;
    if (txt) s.textContent = txt;
    return s;
  }

  function createLineItemRow() {
    var tr = document.createElement('tr');
    var td1 = document.createElement('td');
    var d1 = document.createElement('div'); d1.className = 'item-desc';
    d1.appendChild(createEditableSpan('', 'Service or product name', ''));
    var d2 = document.createElement('div'); d2.className = 'item-subdesc';
    d2.appendChild(createEditableSpan('', 'Additional details...', ''));
    td1.appendChild(d1); td1.appendChild(d2);
    var td2 = document.createElement('td'); td2.appendChild(createEditableSpan('qty', '0', '1'));
    var td3 = document.createElement('td'); td3.appendChild(createEditableSpan('rate', '0.00', '0.00'));
    var td4 = document.createElement('td'); td4.className = 'line-total'; td4.textContent = '$0.00';
    tr.appendChild(td1); tr.appendChild(td2); tr.appendChild(td3); tr.appendChild(td4);
    return tr;
  }

  // ═══ AUTO-CALCULATE ═══
  function recalc() {
    var rows = document.querySelectorAll('#itemsBody tr');
    var subtotal = 0;
    rows.forEach(function(r) {
      var q = parseFloat((r.querySelector('.qty') || {}).textContent) || 0;
      var rt = parseFloat((r.querySelector('.rate') || {}).textContent) || 0;
      var lt = q * rt; subtotal += lt;
      var c = r.querySelector('.line-total'); if (c) c.textContent = '$' + lt.toFixed(2);
    });
    var tr = parseFloat(document.getElementById('taxRate').textContent) || 0;
    var dv = parseFloat(document.getElementById('discount').textContent) || 0;
    var tax = subtotal * (tr / 100);
    document.getElementById('subtotal').textContent = '$' + subtotal.toFixed(2);
    document.getElementById('taxAmount').textContent = '$' + tax.toFixed(2);
    document.getElementById('totalDue').textContent = '$' + (subtotal + tax - dv).toFixed(2);
  }

  function addRow() {
    var tbody = document.getElementById('itemsBody');
    var nr = createLineItemRow(); tbody.appendChild(nr);
    attachListeners(nr);
    nr.querySelector('.item-desc [contenteditable]').focus();
  }

  function resetInvoice() {
    if (confirm('Reset all fields?')) {
      document.querySelectorAll('[contenteditable]').forEach(function(el) { if (!el.id) el.textContent = ''; });
      document.getElementById('taxRate').textContent = '0';
      document.getElementById('discount').textContent = '0.00';
      recalc();
    }
  }

  function attachListeners(scope) {
    (scope || document).querySelectorAll('.qty, .rate').forEach(function(el) {
      el.addEventListener('input', recalc); el.addEventListener('blur', recalc);
    });
  }

  document.getElementById('taxRate').addEventListener('input', recalc);
  document.getElementById('discount').addEventListener('input', recalc);
  attachListeners();

  // ═══ STATUS BADGE ═══
  document.getElementById('statusBadge').addEventListener('click', function() {
    this.classList.toggle('paid');
    this.querySelector('.status-text').textContent = this.classList.contains('paid') ? 'Paid' : 'Pending';
  });

  // ═══ PDF DOWNLOAD ═══
  function downloadPdf() {
    recalc();
    var card = document.getElementById('holoCard');
    var fn = 'HeartmindSpaces-' + (document.querySelector('.meta-value [contenteditable]').textContent || 'HMS-0001') + '.pdf';
    wrap.style.animation = 'none'; wrap.style.transform = 'none';
    var hide = ['.add-row', '.scan-bar', '.chroma-edge', '.glitch-layer', '.corner', '.hud-label'];
    hide.forEach(function(s) { document.querySelectorAll(s).forEach(function(e) { e.style.display = 'none'; }); });
    card.style.animation = 'none'; card.style.background = '#0a1a2a'; card.style.border = '1px solid #1a3a5a';
    html2pdf().set({
      margin: [0.3,0.3,0.3,0.3], filename: fn,
      image: {type:'jpeg',quality:0.98},
      html2canvas: {scale:2,useCORS:true,backgroundColor:'#0a1a2a'},
      jsPDF: {unit:'in',format:'a4',orientation:'portrait'}
    }).from(card).save().then(function() {
      hide.forEach(function(s) { document.querySelectorAll(s).forEach(function(e) { e.style.display = ''; }); });
      card.style.animation = ''; card.style.background = ''; card.style.border = '';
      wrap.style.animation = ''; wrap.style.transform = '';
    });
  }

  // ═══ SAVE HTML ═══
  function saveAsHtml() {
    recalc();
    var fn = 'HeartmindSpaces-' + (document.querySelector('.meta-value [contenteditable]').textContent || 'HMS-0001') + '.html';
    var clone = document.documentElement.cloneNode(true);
    ['.toolbar','.add-row','script','.proton-intro','#burstCanvas'].forEach(function(s) {
      clone.querySelectorAll(s).forEach(function(e) { e.remove(); });
    });
    clone.querySelectorAll('[contenteditable]').forEach(function(e) { e.removeAttribute('contenteditable'); e.removeAttribute('data-placeholder'); });
    var c = clone.querySelector('.invoice-container');
    if (c) { c.style.opacity = '1'; c.style.transform = 'none'; c.style.pointerEvents = 'auto'; }
    var b = clone.querySelector('body'); if (b) b.style.cursor = 'default';
    var badge = clone.querySelector('.status-badge'); if (badge) badge.style.cursor = 'default';
    var blob = new Blob(['<!DOCTYPE html>\n' + clone.outerHTML], { type: 'text/html;charset=utf-8' });
    var url = URL.createObjectURL(blob);
    var a = document.createElement('a'); a.href = url; a.download = fn;
    document.body.appendChild(a); a.click(); document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  // ═══ TOOLBAR ═══
  document.getElementById('downloadPdfBtn').addEventListener('click', downloadPdf);
  document.getElementById('saveHtmlBtn').addEventListener('click', saveAsHtml);
  document.getElementById('printBtn').addEventListener('click', function() { window.print(); });
  document.getElementById('addRowBtn').addEventListener('click', addRow);
  document.getElementById('addRowBtn2').addEventListener('click', addRow);
  document.getElementById('recalcBtn').addEventListener('click', recalc);
  document.getElementById('resetBtn').addEventListener('click', resetInvoice);
</script>

</body>
</html>
